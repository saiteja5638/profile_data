sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/core/util/File","sap/m/MessageToast","sap/ui/core/format/DateFormat"],function(e,t,o,a,n,r,s,i){"use strict";var l;var u=t.ExportType;return e.extend("orderdata.controller.View1",{onInit:function(){l=this;if(!l.create){l.create=sap.ui.xmlfragment("orderdata.view.create",l)}if(!l.downloadTem){l.downloadTem=sap.ui.xmlfragment("orderdata.view.downloadtem",l)}},onValueHelpRequest:function(e){if(!this.suggestDialog){this.suggestDialog=this.loadFragment({name:"orderdata.view.SelectProd"})}this.suggestDialog.then(e=>{e.open()}).then(()=>{var e=this.getOwnerComponent().getModel("oData");var t=new sap.ui.model.json.JSONModel;e.read("/Options",{success:async function(e){var o=e.results;const a=o.filter(e=>o.indexOf(e)>0);await t.setData({items:a});l.byId("_IDGe").setModel(t)},error:function(e){console.log(e)}})})},onValueHelpRequest1:function(){if(!l.suggestUniq){l.suggestUniq=l.loadFragment({name:"orderdata.view.SelectUniq"})}l.suggestUniq.then(e=>{e.open()}).then(()=>{if(l.create.isOpen()){var e=new sap.ui.model.json.JSONModel;var t=l.getOwnerComponent().getModel("oData");var o=sap.ui.getCore().byId("Configurable_Product_1").getValue();t.read("/ORDERS",{success:function(t){var a=[];t.results.forEach(e=>{if(e.PRODUCT===o){a.push(e)}});e.setData({items:a});l.byId("_IDGe25bfvbfb").setModel(e)},error:function(e){console.log(e)}})}else{var a=new sap.ui.model.json.JSONModel;var t=l.getOwnerComponent().getModel("oData");var n=this.byId("_IDGenInput2").mProperties.value;t.read("/ORDERS",{success:function(e){var t=[];e.results.forEach(e=>{if(e.PRODUCT===n){t.push(e)}});a.setData({items:t});l.byId("_IDGe25bfvbfb").setModel(a)},error:function(e){console.log(e)}})}})},onValueHelpDialogClose:function(e){var t=e.getParameter("selectedItem");if(!t){return}const o=t.getTitle();if(l.create.isOpen()){sap.ui.getCore().byId("Configurable_Product_1").setValue(o)}else{l.byId("_IDGenInput2").setValue(o)}},onValueHelpDialogClose1:function(e){var t=e.getParameter("selectedItem");if(!t){return}const o=t.getTitle();if(l.create.isOpen()){sap.ui.getCore().byId("UniqueType_1").setValue(o)}else{l.byId("_IDGenInput3").setValue(o)}},Go:function(){var e=l.getOwnerComponent().getModel("oData");var t=this.byId("_IDGenInput2").mProperties.value;if(!t){alert("Please select the Product !")}let o=l.byId("_IDGenInput3").getValue();let a=l.byId("dateRangeSelection");var n=new sap.ui.model.json.JSONModel;e.read("/ORDERS",{success:function(e){var r=e.results.filter(e=>e.PRODUCT==t);if(o){r=r.filter(e=>e.UNIQUEID==o)}if(a.getFrom()&&a.getTo()){r=r.filter(e=>new Date(e.CREADTEDDATE)>=new Date(a.getFrom())&&new Date(e.CREADTEDDATE)<=new Date(a.getTo()))}n.setData({items:r});l.byId("table").setModel(n)},error:function(e){console.log(e)}})},onCreate:function(){l.create.open();sap.ui.getCore().byId("Configurable_Product_1").setValue("");sap.ui.getCore().byId("UniqueType_1").setValue("");sap.ui.getCore().byId("Order_quantity").setValue("");sap.ui.getCore().byId("Date_range_125").setValue("")},onCloseorder:function(){l.create.close()},onOrderSubmit:function(){var e=l.getOwnerComponent().getModel("oData");let t=sap.ui.getCore().byId("Date_range_125");var o=new Date;var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd/MM/yyyy"});var n=a.format(o);e.read("/ORDERS",{success:function(o){const a=o.results;const r={SEEDORDER:"SE0000"+(a.length+1),PRODUCT:sap.ui.getCore().byId("Configurable_Product_1").getValue(),UNIQUEID:sap.ui.getCore().byId("UniqueType_1").getValue(),ORDERQUANTITY:sap.ui.getCore().byId("Order_quantity").getValue(),MATERIALAVAILDATE:t.getValue(),CREADTEDDATE:n};var s=[];s.push(r);e.callFunction("/seed_order",{method:"GET",urlParameters:{FLAG:"O",Data:JSON.stringify(s)},success:function(){console.log("successfully created")},error:function(){console.log(error)}})}});l.create.close()},seed_search:function(){const e=l.byId("LiveSearch").getProperty("value");var t=[];t.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("SEEDORDER",sap.ui.model.FilterOperator.Contains,e),new sap.ui.model.Filter("SEEDORDER",sap.ui.model.FilterOperator.Contains,e)],and:false}));var o=l.byId("table");var a=o.getBinding("items");a.filter(t)},reset:function(){l.byId("dateRangeSelection").setValue("");l.byId("_IDGenInput3").setValue("");this.byId("_IDGenInput2").setValue("");l.byId("table").setModel(new sap.ui.model.json.JSONModel({}))},open_Download_tem:function(){l.downloadTem.open()},close_Download_tem:function(){l.downloadTem.close()},download_file:function(){const e=sap.ui.getCore().byId("_IDGenDateRangeSelection1");function t(e,t){const o=[];o.unshift("UNIQUE_ID");o.unshift("PRODUCT_ID");var a=i.getDateInstance({pattern:"dd/MM/yyyy"});const n=new Date(e);const r=new Date(t);while(n<=r){if(n.getDay()===1){o.push(a.format(new Date(n)));a.format}n.setDate(n.getDate()+1)}return o}const a=e.getFrom();const n=e.getTo();let r=t(a,n);var s,u,c;s=l.createColumnConfig(r);u={workbook:{columns:s},dataSource:[],fileName:"templete.xlsx",worker:true};c=new o(u);c.build().finally(function(){c.destroy()})},createColumnConfig:function(e){var t=[];var o=e.length;for(let a=0;a<o;a++){t.push({property:e[a]})}return t},onFileSelect:function(e){var t=e.getSource();var o=e.getParameter("files")[0];if(o&&window.FileReader){var a=new FileReader;a.onload=function(e){var t=e.target.result;var o=XLSX.read(t,{type:"binary"});var a=o.SheetNames[0];var n=XLSX.utils.sheet_to_json(o.Sheets[a]);function r(e){const t=[];const{PRODUCT_ID:o,UNIQUE_ID:a,...n}=e;for(const[e,r]of Object.entries(n)){const n={PRODUCT_ID:o,UNIQUE_ID:a,date:e,Quantity:r};t.push(n)}return t}let s=[];n.forEach(e=>{const t=r(e);t.forEach(e=>{s.push(e)})});var i=l.getOwnerComponent().getModel("oData");var u=new Date;var c=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd/MM/yyyy"});var d=c.format(u);i.read("/ORDERS",{success:function(e){const t=e.results;let o=[];for(let e=0;e<s.length;e++){let a={SEEDORDER:"SE0000"+(t.length+e+1),PRODUCT:s[e].UNIQUE_ID,UNIQUEID:s[e].PRODUCT_ID,ORDERQUANTITY:s[e].Quantity,MATERIALAVAILDATE:s[e].date,CREADTEDDATE:d};o.push(a)}console.log(o);i.callFunction("/seed_order",{method:"GET",urlParameters:{FLAG:"O1",Data:JSON.stringify(o)},success:function(){console.log("successfully created")},error:function(){console.log(error)}})}})};a.onerror=function(){s.show("Error reading the file")};a.readAsBinaryString(o)}}})});